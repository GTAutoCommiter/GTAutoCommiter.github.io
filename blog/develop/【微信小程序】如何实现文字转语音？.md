# å‰è¨€

* éœ€æ±‚ï¼šå¾®ä¿¡å°ç¨‹åºå¦‚ä½•å®ç°æä¾›æŒ‡å®šçš„æ–‡æœ¬ï¼Œç„¶åé‡‡å–è¯­éŸ³æ’­æŠ¥ï¼Ÿ

* ç¯å¢ƒï¼š

  ````json
  "@tarojs/react": "3.5.12",
  "react": "^18.0.0"
  ````

# å®ç°

* å¼•å…¥æ’ä»¶ï¼š[å¾®ä¿¡åŒå£°ä¼ è¯‘](https://mp.weixin.qq.com/wxopen/plugindevdoc?appid=wx069ba97219f66d99&token=1441399898&lang=zh_CN)

## å…·ä½“æ­¥éª¤

1. å°ç¨‹åºç”³è¯·æ’ä»¶

   ````bash
   å°ç¨‹åºæ§åˆ¶å°>è´¦å·è®¾ç½®>ç¬¬ä¸‰æ–¹è®¾ç½®>æ’ä»¶ç®¡ç†>æ·»åŠ æ’ä»¶
   ````

2. é¡¹ç›®å¼•å…¥æ’ä»¶

   1. è¿›å…¥é¡¹ç›®`app.config.js`(é¡¹ç›®é…ç½®æ–‡ä»¶)

      ````javascript
      export default defineAppConfig({
        pages: [
          //...
        ],
        subPackages: [
          //...
        ],
        plugins: {
          WechatSI: { version: '0.3.6', provider: 'wx069ba97219f66d99' },
        },
        //...
      })
      
      ````

      > âš ï¸æ³¨æ„ï¼š`version`å’Œ`provider`å¯¹åº”æ–‡æ¡£é…åˆè®¾ç½®

   2. å°è£…æ–¹æ³•

      ````javascript
      const plugin = requirePlugin("WechatSI");
      
      /**
       * @func è¯­éŸ³åˆæˆ
       * @desc apiæ–‡æ¡£
       * https://mp.weixin.qq.com/wxopen/plugindevdoc?appid=wx069ba97219f66d99&token=1441399898&lang=zh_CN
       */
      function textToSpeech(args) {
        const mediaAudioPlayer = wx.createInnerAudioContext();
        plugin.textToSpeech({
          lang: "zh_CN",
          tts: true,
          success: ({ filename }) => {
            mediaAudioPlayer.autoplay = true;
            mediaAudioPlayer.src = filename;
            mediaAudioPlayer.play();
          },
          fail: (e) => {
            console.log("ğŸš€ ~ file: index.jsx:18 ~ useEffect ~ e:", e);
          },
          ...args,
        })
      }
      ````

      `args<object>`ï¼šå‚æ•°ä¸æ–‡æ¡£ä¸­`textToSpeech`æ–¹æ³•å‚æ•°ä¸€è‡³

      | å…³é”®å‚æ•° | æè¿°               |
      | -------- | ------------------ |
      | content  | éœ€è¦è¯­éŸ³æ’­æŠ¥çš„æ–‡æœ¬ |

# ç–‘é—®

> ä»¥ä¸‹æ˜¯æœ¬äººå¯¹æ”¹å†…å®¹çš„ä¸€äº›ç–‘é—®ï¼Ÿæ³è¯·è¯»è€…èƒ½ä¸ºæˆ‘æŒ‡ç‚¹è¿·æ´¥ï¼Œååˆ†æ„Ÿè°¢ğŸ™

Qï¼š`createInnerAudioContext`çš„[æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/wx.createInnerAudioContext.html)ä¸­æœ‰`destroy`æ–¹æ³•ï¼Œè¯¥å¦‚ä½•åœ¨è¯­éŸ³æ’­æ”¾å®Œåè°ƒç”¨è¯¥æ–¹æ³•ï¼Ÿ

* å°è¯•æ–¹æ³•

  ````javascript
  //âŒ è¯­éŸ³æ²¡æ’­æŠ¥å‡ºæ¥å°±é”€æ¯äº†
  function textToSpeech(args) {
    const mediaAudioPlayer = wx.createInnerAudioContext();
    try{
      plugin.textToSpeech({
        //...,
      }) 
    }finally{
      mediaAudioPlayer.destroy();
    }
  }
  
  //âŒ ä¸å­˜åœ¨.thenæ–¹æ³•
  function textToSpeech(args) {
    const mediaAudioPlayer = wx.createInnerAudioContext();
    plugin.textToSpeech({
      //...,
    }).then(()=>{
      mediaAudioPlayer.destroy();
    })
  }
  
  // ä¸‡ä¸€è¯­éŸ³æ—¶é•¿è¶…è¿‡1ç§’ï¼Œæ˜¯å¦ä¼šè¢«æå‰é”€æ¯
  function textToSpeech(args) {
    const mediaAudioPlayer = wx.createInnerAudioContext();
    plugin.textToSpeech({
      //...,
    })
    setTimeout(()=>{
      mediaAudioPlayer.destroy();
    },1000)
  }
  ````

Qï¼šè‹¥ä¸è°ƒç”¨`destroy`æ–¹æ³•ä¼šäº§ç”Ÿå†…å­˜æ³„éœ²ä¸ï¼Ÿ

