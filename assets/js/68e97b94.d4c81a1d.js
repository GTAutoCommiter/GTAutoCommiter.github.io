"use strict";(self.webpackChunkjv_blog=self.webpackChunkjv_blog||[]).push([[1031],{374:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>a});var t=r(4848),s=r(8453);const i={},l="Promise",c={id:"javascript/JavaScript\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1/Promise\u4e0e\u5f02\u6b65\u51fd\u6570",title:"Promise",description:"* \u5b58\u5728\u4e09\u4e2a\u72b6\u6001\uff1apadding\uff08\u7b49\u5f85\uff09\u3001fulfilled\uff08\u5b8c\u6210\uff09\u3001rejected\uff08\u62d2\u7edd\uff09\u3002",source:"@site/docs/javascript/JavaScript\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1/Promise\u4e0e\u5f02\u6b65\u51fd\u6570.md",sourceDirName:"javascript/JavaScript\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1",slug:"/javascript/JavaScript\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1/Promise\u4e0e\u5f02\u6b65\u51fd\u6570",permalink:"/docs/javascript/JavaScript\u9ad8\u7ea7\u7a0b\u5e8f\u8bbe\u8ba1/Promise\u4e0e\u5f02\u6b65\u51fd\u6570",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"javascript",previous:{title:"JSON",permalink:"/docs/javascript-program-design-json"},next:{title:"\u4ee3\u7406\u4e0e\u53cd\u5c04",permalink:"/docs/javascript-program-design-proxy"}},o={},a=[{value:"promise\u6784\u9020\u51fd\u6570\u5982\u4f55\u5b9e\u73b0?",id:"promise\u6784\u9020\u51fd\u6570\u5982\u4f55\u5b9e\u73b0",level:2},{value:"Promise.then\u65b9\u6cd5\u5982\u4f55\u5b9e\u73b0\uff1f",id:"promisethen\u65b9\u6cd5\u5982\u4f55\u5b9e\u73b0",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"promise",children:"Promise"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["\u5b58\u5728\u4e09\u4e2a\u72b6\u6001\uff1a",(0,t.jsx)(n.code,{children:"padding"}),"\uff08\u7b49\u5f85\uff09\u3001",(0,t.jsx)(n.code,{children:"fulfilled"}),"\uff08\u5b8c\u6210\uff09\u3001",(0,t.jsx)(n.code,{children:"rejected"}),"\uff08\u62d2\u7edd\uff09\u3002"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\u26a0\ufe0f\u6ce8\u610f\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"padding"}),"\u53ef\u4ee5\u8f6c\u4e3a",(0,t.jsx)(n.code,{children:"fulfilled"}),"\u6216",(0,t.jsx)(n.code,{children:"rejected"}),"\uff0c\u4e14\u4e0d\u53ef\u9006\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"fulfilled"}),"\u4e0d\u80fd\u4e0e",(0,t.jsx)(n.code,{children:"rejected"}),"\u76f8\u4e92\u8f6c\u6362\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"promise\u6784\u9020\u51fd\u6570\u5982\u4f55\u5b9e\u73b0",children:"promise\u6784\u9020\u51fd\u6570\u5982\u4f55\u5b9e\u73b0?"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'\nconst PROMISE_TYPE = {\n  PADDING: \'padding\',\n  FULFILLED: "fulfilled",\n  REJECTED: "rejected",\n}\nexport class MyPromise {\n  constructor(exec) {\n    //\u521d\u59cb\u5316\u72b6\u6001\u4e3apadding\n    this.state = PROMISE_TYPE.PADDING;\n    this.value = undefined;\n    this.reason = undefined;\n    this.onFulfilledCallbacks = [];\n    this.onRejectedCallbacks = [];\n    //\u8bbe\u7f6eresolve\u65b9\u6cd5\n    const resolve = (value) => {\n      //\u53ea\u6709\u72b6\u6001\u4e3apadding\uff0c\u624d\u5141\u8bb8\u6539\u53d8\u72b6\u6001\n      if (this.state === PROMISE_TYPE.PADDING) {\n        this.value = value;\n        this.state = PROMISE_TYPE.FULFILLED;\n        this.onFulfilledCallbacks.forEach((fn) => fn());\n      }\n    }\n    //\u8bbe\u7f6ereject\u65b9\u6cd5\n    const reject = (reason) => {\n      //      //\u53ea\u6709\u72b6\u6001\u4e3apadding\uff0c\u624d\u5141\u8bb8\u6539\u53d8\u72b6\u6001\n      if (this.state === PROMISE_TYPE.PADDING) {\n        this.reason = reason;\n        this.state = PROMISE_TYPE.REJECTED;\n        this.onRejectedCallbacks.forEach((fn) => fn());\n      }\n    }\n    try {\n      exec(resolve, reject);\n    } catch (error) {\n      reject(error)\n    }\n  }\n  //...\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"promisethen\u65b9\u6cd5\u5982\u4f55\u5b9e\u73b0",children:"Promise.then\u65b9\u6cd5\u5982\u4f55\u5b9e\u73b0\uff1f"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"export class MyPromise {\n  constructor(exec) {\n   //...\u8be6\u60c5\u8bf7\u770bpromise\u6784\u9020\u51fd\u6570\u5982\u4f55\u5b9e\u73b0?\n  }\n  then(onFulfilled, onRejected) {\n    onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : v => v;\n\n    onRejected = typeof onRejected === 'function' ? onRejected : err => { throw err }\n\n    let p2 = new MyPromise((resolve, reject) => {\n      //\u5904\u7406\u5f02\u6b65\u56de\u8c03\n      if (this.state === PROMISE_TYPE.PADDING) {\n        //\u5c06\u6210\u529f\u56de\u8c03\u538b\u5165\u6210\u529f\u56de\u8c03\u6808\u4e2d\n        this.onFulfilledCallbacks.push(() => {\n          setTimeout(() => {\n            try {\n              let x = onFulfilled(this.value);\n              resolvePromise(p2, x, resolve, reject);\n            } catch (error) {\n              reject(error);\n            }\n          }, 0)\n        })\n        \n        //\u5c06\u5931\u8d25\u56de\u8c03\u538b\u5165\u5931\u8d25\u56de\u8c03\u6808\u4e2d\n        this.onRejectedCallbacks.push(() => {\n          setTimeout(() => {\n            try {\n              let x = onRejected(this.reason);\n              resolvePromise(p2, x, resolve, reject);\n            } catch (error) {\n              reject(error);\n            }\n          }, 0)\n        })\n      }\n      // \u5904\u7406\u6210\u529f\u56de\u8c03\u7ed3\u679c\n      if (this.state === PROMISE_TYPE.FULFILLED) {\n        setTimeout(() => {\n          try {\n            let x = onFulfilled(this.value);\n            resolvePromise(p2, x, resolve, reject);\n          } catch (e) {\n            reject(e);\n          }\n        }, 0)\n      }\n      // \u5904\u7406\u5931\u8d25\u56de\u8c03\u7ed3\u679c\n      if (this.state === PROMISE_TYPE.REJECTED) {\n        setTimeout(() => {\n          try {\n            let x = onRejected(this.reason);\n            resolvePromise(p2, x, resolve, reject);\n          } catch (e) {\n            reject(e);\n          }\n        }, 0)\n      }\n    })\n\n  }\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"resolvePromise"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const resolvePromise = (promise2, x, resolve, reject) => {\n  if (promise2 === x) {\n    return reject(new TypeError('Chaining cycle detected for promise #<Promise>'))\n  }\n  let called;\n  if ((typeof x === 'object' && x != null) || typeof x === 'function') {\n    try {\n      let then = x.then;\n      if (typeof then === 'function') {\n        then.call(x, y => {\n          if (called) return;\n          called = true;\n          resolvePromise(promise2, y, resolve, reject);\n        }, r => {\n          if (called) return;\n          called = true;\n          reject(r);\n        })\n      } else {\n        resolve(x);\n      }\n    } catch (error) {\n      if (called) return;\n      called = true;\n      reject(error);\n    }\n  } else {\n    resolve(x);\n  }\n}\n"})}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>c});var t=r(6540);const s={},i=t.createContext(s);function l(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);